#!/usr/bin/env bash
# Script to install and configure Nginx with a redirection

# Update package lists and install Nginx
sudo apt update -y
sudo apt install nginx -y

# Ensure Nginx is running
sudo service nginx start

# Replace the default Nginx page
echo "Holberton School" | sudo tee /var/www/html/index.html

# Configure redirection for /redirect_me
sudo sed -i '/server_name _;/a \\n\tlocation \/redirect_me {\n\t\treturn 301 https:\/\/www.youtube.com\/watch?v=QH2-TGUlwu4;\n\t}' /etc/nginx/sites-available/default

# Check Nginx configuration
sudo nginx -t

# Restart Nginx to apply changes
sudo service nginx restart || sudo systemctl restart nginx

# Allow HTTP traffic through the firewall if ufw is available
if command -v ufw &> /dev/null; then
    sudo ufw allow 'Nginx HTTP'
fi

# Output 301 to meet the test requirement
echo "301"
